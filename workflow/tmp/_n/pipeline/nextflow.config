
/* 
 * defines execution profiles for different environments  
 */ 

profiles {

  standard {

    params {

		
	}
	
  }
  
  apptainer {
  
	params {

		R_USER_CACHE_DIR="${R_USER_CACHE_DIR}"
		R_USER_CONFIG_DIR="${R_USER_CONFIG_DIR}"
		R_USER_DATA_DIR="${R_USER_DATA_DIR}"
	
		fastq_file_list = "${PROJDIR}/output/intermediate/04_create_avatar_file_list/avatar_fastq_file_list.json"
		bam_metadata = "${TCGA_GBM_METADATA_DIR}/gdc_sample_sheet.2025-01-06.csv"
		bam_dir = "${TCGA_GBM_BAM_DIR}"
		output_dir = "${PROJDIR}/output/results/preprocessing/tcga_gbm_rna_seq"
		outdir = "${params.output_dir}/output"
		logdir = "${params.output_dir}/logs"
		scriptdir = "${projectDir}/scripts"
		star_index_dir = "${PROJDIR}/output/resources/star_index/human"
		transcriptome_fasta = "${PROJDIR}/data/resources/human/genome/gencode.v46.transcripts.fa"
		gtf_file = "${PROJDIR}/data/resources/human/genome/gencode.v46.basic.annotation.gtf"
		transcriptome_fasta_digest = "${PROJDIR}/data/resources/human/genome/transcript_fasta_digest.json"

	}

	process {
	
		container = "file://${PROJDIR}/containers/guix/preprocessing_profile/container.squashfs"
		executor = "slurm"

		withName: bam_to_fastq {
			cpus = 16
			memory = 64.GB
			time = '3h'
		}

		withName: perform_fastqc {
			cpus = 16
			memory = 64.GB
			time = '2h'
		}

		withName: perform_multiqc {
			cpus = 1
			memory = 8.GB
			time = '1h'
		}

		withName: perform_STAR {
			cpus = 16
			memory = 256.GB
			time = '5h'
		}

		withName: perform_salmon {
			cpus = 16
			memory = 64.GB
			time = '1h'
		}

		withName: perform_tximeta {
			cpus = 1
			memory = 256.GB
			time = '1h'
		}
		
	}
	
	apptainer.autoMounts = false
	apptainer.enabled = true
	apptainer.runOptions = "--bind ${PROJDIR},${TMPDIR},${TCGA_GBM_DIR}"
	
  }

}
